export const messages = {
  en: {
    "app.title": "Card Duel",
    "toggle.theme.dark": "Night",
    "toggle.theme.light": "Day",
    "toggle.lang.zh": "中文a",
    "toggle.lang.en": "English",
    "entry.eyebrow": "Card Duel Lobby",
    "entry.title": "Create or Join a Room",
    "entry.subtitle": "Enter a room ID and your name to get ready for a match.",
    "entry.room_id": "Room ID",
    "entry.room_placeholder": "e.g. 1001",
    "entry.player_name": "Player Name",
    "entry.player_placeholder": "e.g. Alex",
    "entry.create": "Create Room",
    "entry.join": "Join Room",
    "entry.error.room_required": "Room ID is required.",
    "entry.error.room_numeric": "Room ID must be numeric.",
    "entry.error.name_required": "Player name is required.",
    "entry.error.room_not_found": "Room not found.",
    "create.eyebrow": "Create Room",
    "create.title": "Start a New Match",
    "create.subtitle": "Enter your name to generate a room.",
    "create.player_name": "Player Name",
    "create.player_placeholder": "e.g. Alex",
    "create.error.name_required": "Player name is required.",
    "create.back": "Back to Lobby",
    "create.confirm": "Create Room",
    "create.bot": "Robot Challenge",
    "match.eyebrow": "Matching Room",
    "match.title": "Finding an Opponent",
    "match.subtitle": "Stay on this screen while we match you.",
    "match.label.room": "Room",
    "match.label.player": "Player",
    "match.label.user_id": "User ID",
    "match.label.players": "Players",
    "match.label.status": "Status",
    "match.label.wait_time": "Wait Time",
    "match.pending": "pending",
    "match.empty": "Missing room or player info. Please return to the lobby.",
    "match.back": "Back to Lobby",
    "match.seconds": "s",
    "status.waiting": "waiting",
    "status.playing": "playing",
    "status.finished": "finished",
    "battle.round": "Round",
    "battle.title": "Duel in Progress",
    "battle.subtitle": "Choose a card and wait for your opponent.",
    "battle.current": "Current",
    "battle.back": "Back to Lobby",
    "battle.you": "You",
    "battle.opponent": "Opponent",
    "battle.id": "ID",
    "battle.hp": "HP",
    "battle.choose_card": "Choose Your Card",
    "battle.waiting": "Waiting for opponent",
    "battle.your_move": "Your move",
    "battle.locked": "Card locked in. Await the other player.",
    "battle.pick": "Pick a card to submit.",
    "battle.selected": "Selected",
    "battle.latest_result": "Latest Result",
    "battle.result": "Result",
    "battle.net": "Net",
    "battle.results_pending": "Results will appear after both players act.",
    "battle.unknown": "Unknown",
    "battle.pending": "pending",
    "battle.confirm": "Confirm",
    "battle.vs": "VS",
    "action.attack": "Attack",
    "action.defend": "Defend",
    "action.rest": "Rest",
    "action.attack_desc": "Punish Rest, but clashes hurt both sides.",
    "action.defend_desc": "Steady choice: usually -1; safe vs Rest.",
    "action.rest_desc": "Recover vs Defend, but punished by Attack.",
    "result.eyebrow": "Game Over",
    "result.draw": "Draw",
    "result.victory": "Victory",
    "result.defeat": "Defeat",
    "result.p1_win": "Player 1 Wins",
    "result.p2_win": "Player 2 Wins",
    "result.reason_zero": "HP reached 0",
    "result.reason_rounds": "10 rounds complete",
    "result.player_hp": "Your HP",
    "result.opponent_hp": "Opponent HP",
    "result.player1_hp": "Player 1 HP",
    "result.player2_hp": "Player 2 HP",
    "result.your_id": "Your ID",
    "result.round": "Round",
    "result.back": "Back to Lobby",
    "result.rematch": "Rematch",
    "result.unknown": "unknown",
  },
  zh: {
    "app.title": "卡牌对决",
    "toggle.theme.dark": "夜间",
    "toggle.theme.light": "日间",
    "toggle.lang.zh": "中文",
    "toggle.lang.en": "English",
    "entry.eyebrow": "卡牌对决大厅",
    "entry.title": "创建或加入房间",
    "entry.subtitle": "输入房间号和昵称，准备对战。",
    "entry.room_id": "房间号",
    "entry.room_placeholder": "例如 1001",
    "entry.player_name": "玩家昵称",
    "entry.player_placeholder": "例如 小明",
    "entry.create": "创建房间",
    "entry.join": "加入房间",
    "entry.error.room_required": "请填写房间号。",
    "entry.error.room_numeric": "房间号必须是数字。",
    "entry.error.name_required": "请填写玩家昵称。",
    "entry.error.room_not_found": "房间不存在，请检查房间号。",
    "create.eyebrow": "创建房间",
    "create.title": "开始新的对局",
    "create.subtitle": "输入昵称以生成房间。",
    "create.player_name": "玩家昵称",
    "create.player_placeholder": "例如 小明",
    "create.error.name_required": "请填写玩家昵称。",
    "create.back": "返回大厅",
    "create.confirm": "创建房间",
    "create.bot": "机器人挑战",
    "match.eyebrow": "匹配房间",
    "match.title": "寻找对手",
    "match.subtitle": "请保持在此页面等待匹配。",
    "match.label.room": "房间",
    "match.label.player": "玩家",
    "match.label.user_id": "用户ID",
    "match.label.players": "玩家数",
    "match.label.status": "状态",
    "match.label.wait_time": "等待时间",
    "match.pending": "等待中",
    "match.empty": "缺少房间或玩家信息，请返回大厅。",
    "match.back": "返回大厅",
    "match.seconds": "秒",
    "status.waiting": "等待中",
    "status.playing": "进行中",
    "status.finished": "已结束",
    "battle.round": "回合",
    "battle.title": "对决进行中",
    "battle.subtitle": "选择卡牌并等待对手。",
    "battle.current": "当前",
    "battle.back": "返回大厅",
    "battle.you": "你",
    "battle.opponent": "对手",
    "battle.id": "ID",
    "battle.hp": "生命",
    "battle.choose_card": "选择你的卡牌",
    "battle.waiting": "等待对手",
    "battle.your_move": "轮到你了",
    "battle.locked": "卡牌已锁定，等待对手。",
    "battle.pick": "请选择一张卡牌提交。",
    "battle.selected": "已选择",
    "battle.latest_result": "最新结果",
    "battle.result": "结果",
    "battle.net": "净变化",
    "battle.results_pending": "双方出牌后显示结果。",
    "battle.unknown": "未知",
    "battle.pending": "等待中",
    "battle.confirm": "确认",
    "battle.vs": "VS",
    "action.attack": "进攻",
    "action.defend": "防守",
    "action.rest": "休养",
    "action.attack_desc": "克制休养但风险高，遇进攻/防守双方掉血。",
    "action.defend_desc": "相对稳健，多数小损耗；对休养不掉血。",
    "action.rest_desc": "博弈回血：遇防守回血，遇进攻会被重创。",
    "result.eyebrow": "对局结束",
    "result.draw": "平局",
    "result.victory": "胜利",
    "result.defeat": "失败",
    "result.p1_win": "玩家1获胜",
    "result.p2_win": "玩家2获胜",
    "result.reason_zero": "生命值归零",
    "result.reason_rounds": "10 回合结束",
    "result.player_hp": "你的生命",
    "result.opponent_hp": "对手生命",
    "result.player1_hp": "玩家1生命",
    "result.player2_hp": "玩家2生命",
    "result.your_id": "你的ID",
    "result.round": "回合",
    "result.back": "返回大厅",
    "result.rematch": "再来一局",
    "result.unknown": "未知",
  },
} as const;

export type Language = keyof typeof messages;
export type MessageKey = keyof typeof messages.en;
export type Translator = (key: MessageKey) => string;

export const languageStorageKey = "card_duel_lang";

export const getPreferredLanguage = (): Language => {
  if (typeof window === "undefined") {
    return "zh";
  }

  let stored: string | null = null;
  try {
    stored = window.localStorage.getItem(languageStorageKey);
  } catch (error) {
    stored = null;
  }

  if (stored === "en" || stored === "zh") {
    return stored;
  }

  return "zh";
};

export const createTranslator = (language: Language): Translator => {
  const table = messages[language] as Record<MessageKey, string>;
  return (key) => table[key] ?? messages.en[key] ?? key;
};
